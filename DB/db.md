# DB

## 데이터베이스 시스템

### 데이터 언어

#### DDL, 데이터 정의어

***데이터 정의어***는 새로운 데이터베이스를 구축하기 위해 스키마를 정의하거나 기존 스키마의 정의를 삭제 또는 수정하기 위해 사용하는 데이터 언어입니다.

#### DML, 데이터 조작어

***데이터 조작어***는 사용자가 데이터의 삽입, 삭제, 수정, 검색 등의 처리를 데이터베이스 관리 시스템에 요구하기 위해 사용하는 데이터언어입니다.

#### DCL, 데이터 제어어

***데이터 제어어***는 데이터베이스에 저장된 데이터를 여러 사용자가 무결성과 일관성을 유지하면 문제없이 공유할 수 있도록, 내부적으로 필요한 규칙이나 기법을 정의하는 데 사용하는 데이터 언어입니다.

## 데이터 모델링
현실 세계에 존재하는 데이터를 컴퓨터 세계의 데이터베이스로 옮기는 변환 과정을 보통 ***데이터 모델링***이라 합니다.

***데이터 모델***은 데이터 모델링의 결과물을 표현하는 도구입니다.

일반적으로 데이터 모델은 **데이터 구조**, **연산**, **제약조건**으로 구성됩니다.

## 관계 데이터 모델

### 관계 데이터 모델의 기본 용어

#### 속성
**릴레이션의 열**을 속성 또는 attribute라고 부릅니다. 릴레이션은 파일 관리 시스템에서의 파일, 속성은 해당 파일의 필드에 대응되는 개념으로 볼 수 있습니다.

#### 튜플
**릴레이션의 행**을 튜플이라 부릅니다. 튜플은 파일 관리 시스템 관점에서 해당 파일의 레코드에 대응하는 개념으로 볼 수 있습니다.

#### 도메인
**속성 하나가 가질 수 있는 모든 값의 집합**을 해당 속성의 도메인이라 합니다.

#### 널 값
릴레이션에 있는 특정 투플의 속성 값을 모르거나, 적합한 값이 없는 경우에는 **널null**이라는 특별한 값을 사용할 수 있습니다. 널 값은 **특정 속성에 해당되는 값이 없음을 의미**합니다.

#### 차수
**하나의 릴레이션에서 속성의 전체 개수**를 릴레이션의 차수라고합니다.

#### 카디널리티
**하나의 릴레이션에서 튜플의 전체 개수**를 릴레이션의 카디널리티라고합니다.

### 키의 종류
릴레이션에 포함된 **튜플들을 유일하게 구별해주는 역할**은 **속성 또는 속성들의 집합**인 키가 담당합니다. 

키는 **관계 데이터 모델에서 중요한 제약조건을 정의합니다.**

#### 슈퍼키
슈퍼키는 ***유일성***의 특성을 만족하는 속성 또는 속성들의 집합입니다. 

유일성은 키가 갖추어야 하는 기본 특성으로, **하나의 릴레이션에서 키로 지정된 속성 값은 튜플마다 달라야 한다는 의미**입니다.

#### 후보키
후보키는 ***유일성***과 ***최소성***을 만족하는 속성 또는 속성들의 집합입니다.

#### 기본키
**여러 후보키 중에서 기본적으로 사용할 키**를 반드시 선택해야 하는데 이것이 기본키입니다.

*기본키를 선택할 때 고려하면 도움이 되는 기준*

- 널 값을 가질 수 있는 속성이 포함된 후보키는 기본키로 부적합합니다.

- 값이 자주 변경될 수 있는 속성이 포함된 후보키는 기본키로 부적합합니다.

- 단순한 후보키를 기본키로 선택합니다.

#### 대체키
대체키는 **기본키로 선택되지 못한 후보키들**입니다.

#### 외래키
외래키는 **어떤 릴레이션에 소속된 속성 또는 속성 집합이 다른 릴레이션의 기본키**가 되는 키입니다.

다시 말해 **다른 릴레이션의 기본키를 그대로 참조하는 속성의 집합**이 외래키입니다.

### 관계 데이터 모델의 제약
관계 데이터 모델이 기본으로 포함하고 있는 무결성 제약조건에는 ***개체 무경성 제약조건***과 ***참조 무결성 제약조건***이 있습니다.

데이터베이스의 상태를 일관성 있게 유지하기 위해서는 두 가지를 모두 만족시켜야 합니다.

## 정규화
논리적 설계 단계에서 발생 할 수 있는 종속으로 인한 삽입, 갱신, 삭제 이상 현상의 문제점을 해결하기 위해, 속성들 간의 종속 관계를 분석하여 여러 개의 릴레이션으로 분해하는 과정을 말합니다.

### 이상현상의 종류
이상 현상에는 삽입 이상, 갱신 이상, 삭제 이상이 있습니다.

*삽입이상 :* 새 데이터를 삽입하기 위해 불필요한 데이터도 함께 삽입해야 하는 문제

*갱신 이상 :* 중복 튜플 중 일부만 변경하여 데이터가 불일치하게 되는 모순의 문제

*삭제 이상 :* 튜플을 삭제하면 꼭 필요한 데이터까지 함께 삭제되는 데이터 손실의 문제

### 기본 정규형과 정규화 과정

#### 제 1정규형
릴레이션에 속한 모든 속성의 도메인이 원자 값으로만 구성되어 있으면 제 1정규형에 속합니다.

#### 제 2정규형
릴레이션이 제 1정규형에 속하고, 기본키가 아닌 모든 속성이 기본키에 완전 함수 종속되면 제 2정규형에 속합니다. 이 때 완전 함수 종속이란 속성 집합 Y가 속성 집합 X에 함수적으로 종속되어 있을 때, 속성 집합 X 전체에 종속된 것임을 의미합니다. 

#### 제 3정규형
릴레이션이 제 2정규형에 속하고, 기본키가 아닌 모든 속성이 기본키에 이행적 함수 종속이 되지 않으면 제 3정규형에 속합니다. 이행적 함수 종속이란 속성 집합 X,Y,Z가 존재할 때, X -> Z가 이미 종속 관계이고 함수 종속 관계 X->Y, Y->Z가 존재하면, X-> Z가 성립하므로 이행적으로 함수 종속이 성립된다고 볼 수 있습니다.

#### *BCNF 정규형*
릴레이션의 함수 종속 관계에서 모든 결정자가 후보키이면 보이스/코드 정규형에 속합니다.

## 트랜잭션
데이터베이스의 상태를 변환시키는 하나의 논리적 기능을 수행하기 위한 작업의 단위입니다.

### 트랜잭션의 특성
트랜잭션이 제대로 수행되기 위해서는 네가지 ACID 특성이 만족되어야 합니다.

#### 원자성(Atomicity)
일련의 쿼리가 전부 성공할지 실패할지를 보증하는 구조로서, 중간에 쿼리가 실패하여 Rollback 을 통해 처음으로 돌아가고, 모든 쿼리가 성공하면 Commit 을 통해 실행을 확정함으로써 보증하게 됩니다.

#### 일관성(Consistency)
일련의 쿼리 전후로 상태를 유지하는 것을 말합니다. 데이터 별로 제약이 있다면 예를 들어 유니크 제약이 걸린 데이터일 경우 일련의 쿼리가 종료된 후에도 유니크 제약에 만족해야 하는 일관성을 가져야 합니다.

#### 격리성(Isolation)
일련의 쿼리를 동시에 실행해도 각각의 처리가 모순없이 실행되는 것을 보증하는 것을 말합니다. 

#### 지속성(Durability)
일련의 쿼리가 실행완료되었다면 해당 결과는 데이터베이스에 반영되어 영구히 지속되는 것을 말합니다.

### 트랜잭션 격리수준

#### Read Uncommitted
각 트랜잭션에서의 변경 내용이 COMMIT이나 ROLLBACK 여부에 상관 없이 다른 트랜잭션에서 값을 읽을 수 있다.

#### Read Committed
선행하는 트랜잭션이 데이터를 변경할 때 후행하는 트랜잭션은 커밋이 완료된 데이터만 읽기 접근이 가능한 방식입니다. 

#### Repeatable Read
동일한 트랜잭션 내에서 한번이라도 조회한 데이터는 트랜잭션이 끝날때까지 변경 불가하도록 설정하여 반복 조회시에도 같은 데이터가 조회됨을 보장하는 방법입니다. 

#### Serializable
선행한 트랜잭션이 종료된 후 다른 트랜잭션이 실행됩니다.

#### 격리 수준에 따른 문제
(1) Dirty Read

한 트랜잭션(T1)이 데이타에 접근하여 값을 'A'에서 'B'로 변경했고 아직 커밋을 하지 않았을때, 다른 트랜잭션(T2)이 해당 데이타를 Read 하면?

 T2가 읽은 데이타는 B가 될 것이다. 하지만 T1이 최종 커밋을 하지 않고 종료된다면, T2가 가진 데이타는 꼬이게 된다.

(2) Non-Repeatable Read

한 트랜잭션(T1)이 데이타를 Read 하고 있다. 이때 다른 트랜잭션(T2)가 데이타에 접근하여 값을 변경 또는, 데이타를 삭제하고 커밋을 때려버리면?

그 후 T1이 다시 해당 데이타를 Read하고자 하면 변경된 데이타 혹은 사라진 데이타를 찾게 된다.

(3) Phantom Read

트랜잭션(T1) 중에 특정 조건으로 데이타를 검색하여 결과를 얻었다. 이때 다른 트랜잭션(T2)가 접근해 해당 조건의 데이타 일부를 삭제 또는 추가 했을때, 아직 끝나지 않은 T1이 다시 한번 해당 조건으로 데이타를 조회 하면 T2에서 추가/삭제된 데이타가 함께 조회/누락 된다. 그리고 T2가 롤백을 하면? 데이타가 꼬인다.

### 인덱스

#### 인덱스란?

데이터베이스의 검색속도 향상을 위해 유지,관리하는 자료구조

#### Clustered vs Non-Clustered

* Clustered Index

    데이터를 인덱스로 지정한 컬럼에 맞춰서 정렬

    => 테이블 구조에 영향을 미치는 인덱스

    => 한 테이블에 하나만 생성 가능
    
    검색에는 효과적이지만 삽입,삭제시에 비효과적

    PK와 거의 같다고 볼 수 있음

    => 범위 검색에 효율적

    => 존재하는 PK 사이에 Insert될 경우 매우 비효율적

    * Cluster Index - Inno DB

    1. Primary key는 항상 clustered Index

    2. Unique index로 정의된 컬럼 중 하나

    3. 보이지 않는 컬럼을 내부적으로 추가하여 사용

* Non-Clustered Index

    순서와 상관없음
    
    데이터의 주소값을 value값으로 가짐

    삽입,삭제 시에 Hash Function을 이용한다고 봄

    Index와 거의 같다고 볼 수 있음
